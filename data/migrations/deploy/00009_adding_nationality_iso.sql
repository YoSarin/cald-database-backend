SET CHARACTER SET 'utf8';
SET NAMES 'utf8';

CREATE TABLE iso_codes (
    code VARCHAR(3) NOT NULL,
    name VARCHAR(255) NOT NULL
)
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_bin;

INSERT INTO iso_codes VALUES
    ("AFG", "Afghánistán"),
    ("ALA", "Alandské ostrovy"),
    ("ALB", "Albánie"),
    ("DZA", "Alžírsko"),
    ("ASM", "Americká Samoa"),
    ("VIR", "Americké Panenské ostrovy"),
    ("AND", "Andorra"),
    ("AGO", "Angola"),
    ("AIA", "Anguilla"),
    ("ATA", "Antarktida"),
    ("ATG", "Antigua a Barbuda"),
    ("ARG", "Argentina"),
    ("ARM", "Arménie"),
    ("ABW", "Aruba"),
    ("GAZ", "Aslandia"),
    ("AUS", "Austrálie"),
    ("AZE", "Ázerbájdžán"),
    ("BHS", "Bahamy"),
    ("BHR", "Bahrajn"),
    ("BGD", "Bangladéš"),
    ("BRB", "Barbados"),
    ("BEL", "Belgie"),
    ("BLZ", "Belize"),
    ("BLR", "Bělorusko"),
    ("BEN", "Benin"),
    ("BMU", "Bermudy"),
    ("BTN", "Bhútán"),
    ("BOL", "Bolívie"),
    ("BIH", "Bosna a Hercegovina"),
    ("BWA", "Botswana"),
    ("BVT", "Bouvetův ostrov"),
    ("BRA", "Brazílie"),
    ("IOT", "Britské indickooceánské území"),
    ("VGB", "Britské Panenské ostrovy"),
    ("BRN", "Brunej Darussalam"),
    ("BGR", "Bulharsko"),
    ("BFA", "Burkina Faso"),
    ("BDI", "Burundi"),
    ("COK", "Cookovy ostrovy"),
    ("TCD", "Čad"),
    ("MNE", "Černá Hora"),
    ("CZE", "Česká republika"),
    ("CHN", "Čína"),
    ("DNK", "Dánsko"),
    ("DMA", "Dominika"),
    ("DOM", "Dominikánská republika"),
    ("DJI", "Džibutsko"),
    ("EGY", "Egypt"),
    ("ECU", "Ekvádor"),
    ("ERI", "Eritrea"),
    ("EST", "Estonsko"),
    ("ETH", "Etiopie"),
    ("FRO", "Faerské ostrovy"),
    ("FLK", "Falklandy (Malvíny)"),
    ("FJI", "Fidži"),
    ("PHL", "Filipíny"),
    ("FIN", "Finsko"),
    ("FRA", "Francie"),
    ("GUF", "Francouzská Guyana"),
    ("ATF", "Francouzská jižní území"),
    ("PYF", "Francouzská Polynésie"),
    ("GAB", "Gabon"),
    ("GMB", "Gambie"),
    ("GHA", "Ghana"),
    ("GIB", "Gibraltar"),
    ("GRD", "Grenada"),
    ("GRL", "Grónsko"),
    ("GEO", "Gruzie"),
    ("GLP", "Guadeloupe"),
    ("GUM", "Guam"),
    ("GTM", "Guatemala"),
    ("GGY", "Guernsey"),
    ("GIN", "Guinea"),
    ("GNB", "Guinea-Bissau"),
    ("GUY", "Guyana"),
    ("HTI", "Haiti"),
    ("HMD", "Heardův ostrov a McDonaldovy ostrovy"),
    ("HND", "Honduras"),
    ("HKG", "Hongkong"),
    ("CHL", "Chile"),
    ("HRV", "Chorvatsko"),
    ("IND", "Indie"),
    ("IDN", "Indonésie"),
    ("IRQ", "Irák"),
    ("IRN", "Írán"),
    ("IRL", "Irsko"),
    ("ISL", "Island"),
    ("ITA", "Itálie"),
    ("ISR", "Izrael"),
    ("JAM", "Jamajka"),
    ("JPN", "Japonsko"),
    ("YEM", "Jemen"),
    ("JEY", "Jersey"),
    ("ZAF", "Jihoafrická republika"),
    ("SGS", "Jižní Georgie a Jižní Sandwichovy ostrovy"),
    ("JOR", "Jordánsko"),
    ("CYM", "Kajmanské ostrovy"),
    ("KHM", "Kambodža"),
    ("CMR", "Kamerun"),
    ("CAN", "Kanada"),
    ("CPV", "Kapverdy"),
    ("QAT", "Katar"),
    ("KAZ", "Kazachstán"),
    ("KEN", "Keňa"),
    ("KIR", "Kiribati"),
    ("CCK", "Kokosové ostrovy"),
    ("COL", "Kolumbie"),
    ("COM", "Komory"),
    ("COG", "Kongo"),
    ("COD", "Kongo, demokratická republika"),
    ("PRK", "Korejská lid.dem.rep."),
    ("KOR", "Korejská republika"),
    ("XKK", "Kosovo"),
    ("CRI", "Kostarika"),
    ("CUB", "Kuba"),
    ("KWT", "Kuvajt"),
    ("CYP", "Kypr"),
    ("KGZ", "Kyrgyzstán"),
    ("LAO", "Laos"),
    ("LSO", "Lesotho"),
    ("LBN", "Libanon"),
    ("LBR", "Libérie"),
    ("LBY", "Libye"),
    ("LIE", "Lichtenštejnsko"),
    ("LTU", "Litva"),
    ("LVA", "Lotyšsko"),
    ("LUX", "Lucembursko"),
    ("MAC", "Macao"),
    ("MDG", "Madagaskar"),
    ("HUN", "Maďarsko"),
    ("MKD", "Makedonie"),
    ("MYS", "Malajsie"),
    ("MWI", "Malawi"),
    ("MDV", "Maledivy"),
    ("MLI", "Mali"),
    ("MLT", "Malta"),
    ("MAR", "Maroko"),
    ("MHL", "Marshallovy ostrovy"),
    ("MTQ", "Martinik"),
    ("MUS", "Mauricius"),
    ("MRT", "Mauritánie"),
    ("MYT", "Mayotte"),
    ("UMI", "Menší odlehlé ostrovy USA"),
    ("MEX", "Mexiko"),
    ("FSM", "Mikronésie"),
    ("MMF", "MMF"),
    ("MDA", "Moldavsko"),
    ("MCO", "Monako"),
    ("MNG", "Mongolsko"),
    ("MSR", "Montserrat"),
    ("MOZ", "Mosambik"),
    ("MMR", "Myanmar"),
    ("NAM", "Namibie"),
    ("NRU", "Nauru"),
    ("DEU", "Německo"),
    ("NPL", "Nepál"),
    ("NER", "Niger"),
    ("NGA", "Nigérie"),
    ("NIC", "Nikaragua"),
    ("NIU", "Niue"),
    ("ANT", "Nizozemské Antily"),
    ("NLD", "Nizozemsko"),
    ("NFK", "Norfolk"),
    ("NOR", "Norsko"),
    ("NCL", "Nová Kaledonie"),
    ("NZL", "Nový Zéland"),
    ("OMN", "Omán"),
    ("IMN", "Ostrov Man"),
    ("PAK", "Pákistán"),
    ("PLW", "Palau"),
    ("PSE", "Palestina"),
    ("PAN", "Panama"),
    ("PNG", "Papua Nová Guinea"),
    ("PRY", "Paraguay"),
    ("PER", "Peru"),
    ("PCN", "Pitcairn"),
    ("CIV", "Pobřeží slonoviny"),
    ("POL", "Polsko"),
    ("PRI", "Portoriko"),
    ("PRT", "Portugalsko"),
    ("AUT", "Rakousko"),
    ("REU", "Réunion"),
    ("GNQ", "Rovníková Guinea"),
    ("ROM", "Rumunsko"),
    ("RUS", "Rusko"),
    ("RWA", "Rwanda"),
    ("GRC", "Řecko"),
    ("SPM", "Saint Pierre a Miquelon"),
    ("SLV", "Salvador"),
    ("WSM", "Samoa"),
    ("SMR", "San Marino"),
    ("SAU", "Saúdská Arábie"),
    ("SEN", "Senegal"),
    ("MNP", "Severní Mariany"),
    ("SYC", "Seychely"),
    ("SLE", "Sierra Leone"),
    ("SGP", "Singapur"),
    ("SVK", "Slovensko"),
    ("SVN", "Slovinsko"),
    ("SOM", "Somálsko"),
    ("ARE", "Spojené arabské emiráty"),
    ("GBR", "Spojené království"),
    ("USA", "Spojené státy"),
    ("SRB", "Srbsko"),
    ("LKA", "Srí Lanka"),
    ("CAF", "Středoafrická republika"),
    ("SDN", "Súdán"),
    ("SUR", "Surinam"),
    ("SJM", "Svalbard a ostrov Jan Mayen"),
    ("SHN", "Svatá Helena"),
    ("LCA", "Svatá Lucie"),
    ("KNA", "Svatý Kryštof a Nevis"),
    ("VAT", "Svatý stolec (Vatikánský městský stát)"),
    ("STP", "Svatý Tomáš"),
    ("VCT", "Svatý Vincenc a Grenadiny"),
    ("SWZ", "Svazijsko"),
    ("SYR", "Sýrie"),
    ("SLB", "Šalamounovy ostrovy"),
    ("ESP", "Španělsko"),
    ("SWE", "Švédsko"),
    ("CHE", "Švýcarsko"),
    ("TJK", "Tádžikistán"),
    ("TZA", "Tanzanie"),
    ("THA", "Thajsko"),
    ("TWN", "Tchaj-wan"),
    ("TGO", "Togo"),
    ("TKL", "Tokelau"),
    ("TON", "Tonga"),
    ("TTO", "Trinidad a Tobago"),
    ("TUN", "Tunisko"),
    ("TUR", "Turecko"),
    ("TKM", "Turkmenistán"),
    ("TCA", "Turks a Caicos"),
    ("TUV", "Tuvalu"),
    ("UGA", "Uganda"),
    ("UKR", "Ukrajina"),
    ("URY", "Uruguay"),
    ("UZB", "Uzbekistán"),
    ("CXR", "Vánoční ostrov"),
    ("VUT", "Vanuatu"),
    ("VEN", "Venezuela"),
    ("VNM", "Vietnam"),
    ("TLS", "Východní Timor"),
    ("WLF", "Wallis a Futuna"),
    ("ZMB", "Zambie"),
    ("ESH", "Západní Sahara"),
    ("ZWE", "Zimbabwe");
    
UPDATE nationality SET country_name = "Spojené království" WHERE country_name = "Velká Británie";
UPDATE nationality SET country_name = "Tchaj-wan" WHERE country_name = "Thajwan";

ALTER TABLE nationality
    ADD COLUMN iso_code VARCHAR(3) DEFAULT NULL;

UPDATE nationality SET iso_code = (
    SELECT code FROM iso_codes
        WHERE name = nationality.name OR name = nationality.country_name
);

ALTER TABLE nationality
    MODIFY COLUMN iso_code VARCHAR(3) NOT NULL;

DROP TABLE iso_codes;
